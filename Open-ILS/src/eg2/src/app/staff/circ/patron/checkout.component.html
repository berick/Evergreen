
<eg-progress-dialog #progressDialog></eg-progress-dialog>
<eg-barcode-select #barcodeSelect></eg-barcode-select>

<eg-precat-checkout-dialog #precatDialog [barcode]="checkoutBarcode">
</eg-precat-checkout-dialog>
<eg-copy-alerts-dialog #copyAlertsDialog></eg-copy-alerts-dialog>

<eg-prompt-dialog #nonCatCount
  promptType="number"
  i18n-dialogTitle dialogTitle="Non-Cat Checkout"
  promptMin="1" promptValue="1" [promptMax]="maxNoncats"
  i18n-dialogBody
  dialogBody="Enter the number of {{checkoutNoncat ? checkoutNoncat.name() : ''}} circulating">
</eg-prompt-dialog>

<div class="row mb-3 pb-3 border-bottom">
  <div class="col-lg-12 d-flex">
    <div class="form-inline">
      <div class="input-group">
        <div class="input-group-prepend">
          <div ngbDropdown>
            <button ngbDropdownToggle class="btn btn-outline-dark" id="checkout-button">
              <ng-container *ngIf="!checkoutNoncat" i18n>Barcode</ng-container>
              <ng-container *ngIf="checkoutNoncat">{{checkoutNoncat.name()}}</ng-container>
            </button>
            <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
              <button ngbDropdownItem (click)="checkoutNoncat=null" i18n>Barcode</button>
              <div role="separator" class="dropdown-divider"></div>
              <ng-container *ngIf="circ.nonCatTypes">
                <button *ngFor="let nct of circ.nonCatTypes" 
                  (click)="checkoutNoncat=nct" ngbDropdownItem>{{nct.name()}}</button>
              </ng-container>
            </div>
          </div>
        </div>
        <input type="text" class="form-control" id="barcode-input"
          [placeholder]="checkoutNoncat ? '' : 'Barcode...'" i18n-placeholder
          [(ngModel)]="checkoutBarcode" [disabled]="checkoutNoncat != null"
          i18n-aria-label aria-label="Barcode Input" (keydown.enter)="checkout()" />
        <div class="input-group-append">
          <button class="btn btn-outline-dark" (keydown.enter)="checkout()" 
            (click)="checkout()" i18n>Submit</button>
        </div>
      </div>
    </div>
    <div class="flex-1"></div>
    <div ngbDropdown>
      <button ngbDropdownToggle class="btn mr-2" [ngClass]="{
          'btn-outline-dark': dueDateOptions == 0,
          'btn-outline-success': dueDateOptions > 0
        }"
        i18n>Date Options</button>
      <div ngbDropdownMenu>
        <button ngbDropdownItem (click)="toggleDateOptions(1)">
          <span *ngIf="dueDateOptions > 0" 
            class="badge badge-success">&#x2713;</span>  
          <span *ngIf="dueDateOptions == 0" 
            class="badge badge-warning">&#x2717;</span> 
          <span class="pl-2" i18n>Specific Due Date</span>
        </button>
        <button ngbDropdownItem (click)="toggleDateOptions(2)">
          <span *ngIf="dueDateOptions == 2" 
            class="badge badge-success">&#x2713;</span>  
          <span *ngIf="dueDateOptions < 2" 
            class="badge badge-warning">&#x2717;</span> 
          <span class="pl-2" i18n>Specific Due Date Until Logout</span>
        </button>
      </div>
    </div>
    <eg-datetime-select [initialIso]="dueDate" 
      (onChangeAsIso)="setDueDate($event)"></eg-datetime-select>
  </div>
</div>

<ng-template #titleTemplate let-r="row">
  <ng-container *ngIf="r.record">
    <a routerLink="/staff/catalog/record/{{r.record.id()}}">{{r.title}}</a>
  </ng-container>
  <ng-container *ngIf="!r.record">{{r.title}}</ng-container>
</ng-template>

<div class="row">
  <div class="col-lg-12">
    <eg-grid #checkoutsGrid [dataSource]="gridDataSource" [sortable]="true"
      [useLocalSort]="true" [cellTextGenerator]="cellTextGenerator"
      [disablePaging]="true" persistKey="circ.patron.checkout">

			<eg-grid-toolbar-action
				i18n-group group="Add" i18n-label label="Add Item Alerts"
				(onClick)="openItemAlerts($event, 'create')">
			</eg-grid-toolbar-action>

      <eg-grid-column path="index" [index]="true" 
        label="Row Index" i18n-label [hidden]="true"></eg-grid-column>
      <eg-grid-column path="circ.id" label="Circ ID" i18n-label></eg-grid-column>

      <!-- TODO 
        [datePlusTime]="true" when non-full-day circ 
      -->
      <eg-grid-column path="dueDate" label="Due Date" i18n-label
        datatype="timestamp"></eg-grid-column>

      <eg-grid-column path="copy.barcode" label="Barcode" i18n-label></eg-grid-column>

      <eg-grid-column path="title" label="Title" i18n-label 
        [cellTemplate]="titleTemplate"></eg-grid-column>

      <eg-grid-column path="nonCatCount" label="Non-Cataloged Count"
        i18n-label></eg-grid-column>

    </eg-grid>
  </div>
</div>


